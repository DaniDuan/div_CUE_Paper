library(rTPC)
library(nls.multstart)
library(broom)
library(tidyverse)
library(progress)
df_meta <- read.csv("../data/database.csv") %>%
filter(StandardisedTraitName == "Specific Growth Rate") %>%
select(Strain = OriginalID,growth_rate = StandardisedTraitValue,Temperature = ConTemp)  %>%
mutate(source = "meta")
df_experiments <- read.csv("./data/dataset_rates.csv") %>%
select(Strain,growth_rate,Temperature) %>%
mutate(source = "exp")
df_experiments <- read.csv("../data/dataset_rates.csv") %>%
select(Strain,growth_rate,Temperature) %>%
mutate(source = "exp")
#bind
df_full <- full_join(df_meta, df_experiments) %>%
filter(growth_rate > 0.0)
#plot all data
df_full %>%
ggplot(aes(Temperature,growth_rate))+
geom_point()+
facet_wrap(~source, scales = "free")
# fit two chosen model formulation in rTPC
df_nested <- df_full %>%
nest(data = c(growth_rate,Temperature))
number_of_models <- 1
number_of_curves <- nrow(df_nested)
# setup progress bar
pb <- progress::progress_bar$new(total = number_of_curves*number_of_models,
clear = FALSE,
format ="[:bar] :percent :elapsedfull")
df_nested <- df_nested %>%
mutate(E_lm = 0.0, B0_lm = 0.0, E_ss = 0.0, B0_ss = 0.0)
for(i in 1:nrow(df_nested)){
if(!is.null(pb)){
pb$tick()
}
x <- df_nested$data[[i]] %>% filter(growth_rate > 0)
#fit linear model
#find peak
i_pk <- which.max(x$growth_rate)
#format data
x_lin <- x %>%
filter(Temperature < x$Temperature[i_pk]) %>%
mutate(T = 1/(8.617e-5) * ((1/(Temperature + 273.15)) - (1/ 283.15)))
#fit
if(nrow(x_lin) > 3){
if(length(unique(x_lin$T)) > 3 ){
lm_mod <- lm(log(growth_rate) ~ T, data = x_lin)
}
}
if (all(tidy(lm_mod)$p.value < 0.05)) {
df_nested$B0_lm[i] <- coef(lm_mod)[1]
df_nested$E_lm[i] <- coef(lm_mod)[2]
}
#fit sharpe-schoolfield
start_vals <- get_start_vals(x$Temperature, x$growth_rate, model_name = 'sharpeschoolhigh_1981')
start_vals[is.na(start_vals)] = 0.0
start_vals[is.infinite(start_vals)] = 0.0
ss_mod <- tryCatch({
nls_multstart(growth_rate ~ sharpeschoolhigh_1981(temp = Temperature, r_tref, e, eh, th, tref = 10),
data = x,
iter = c(4, 4 ,4 ,4),
start_lower = start_vals - 10,
start_upper = start_vals + 10,
lower = get_lower_lims(x$Temperature, x$growth_rate, model_name = 'sharpeschoolhigh_1981'),
upper = get_upper_lims(x$Temperature, x$growth_rate, model_name = 'sharpeschoolhigh_1981'),
supp_errors = 'Y')},
error = function(e){})
if (!is.null(ss_mod)){
x <- tryCatch(tidy(ss_mod), error = function(x){})
if (!is.null(x)) {
if (!any(is.nan(x$p.value))) {
if (all(x$p.value < 0.05)) {
df_nested$B0_ss[i] <- coef(ss_mod)[1]
df_nested$E_ss[i] <- coef(ss_mod)[2]
}
}
}
}
}
df_final <- df_nested %>%
filter(B0_ss != 0.0, E_ss != 0.0, log(B0_ss) > -15) %>%
mutate(B0 = log(B0_ss), E = E_ss) %>%
group_by(source) %>%
mutate(B0 = (B0 - mean(B0)) / sd(B0))
df_final %>%
ggplot(aes(B0,E, color = source))+
geom_point()
df_final %>%
pivot_longer(c(B0, E)) %>%
ggplot(aes(value)) +
geom_histogram() +
facet_wrap(name~source, scales = "free")
write_csv(df_final, "../data/summary.csv")
setwd('../../div_cue_paper/data')
graphics.off()
library(minpack.lm)
library(ggplot2)
library(reshape2)
library(grid)
k = 8.61*10^(-5)
########
summ = read.csv("../data/summary.csv")
s_data = summ[summ$source == "meta", ]
var(log(s_data$B0_ss))/mean(log(s_data$B0_ss))
var(s_data$E)/mean(s_data$E)
cov(log(s_data$B0_ss), s_data$E)
rho = cov(log(s_data$B0_ss), s_data$E)/(sqrt(var(log(s_data$B0_ss)))*sqrt(var(s_data$E)))
rho
ggplot(s_data, aes(x=B0, y=E)) + labs(x = expression("log(B"[0]*")"), y = "E")+
geom_point(size=4, shape=16,color = "black", alpha = 0.7) + theme_bw() + theme(panel.background = element_blank(), text = element_text(size = 35))
ggplot(s_data, aes(x=B0, y=E)) + labs(x = expression("log(B"[0]*")"), y = "E")+
geom_point(size=4, shape=16,color = "black", alpha = 0.7) + theme_bw() + theme(panel.background = element_blank(), text = element_text(size = 35))
png('../result/B_Ea_empirical.png', width = 800, height = 600)
ggplot(s_data, aes(x=B0, y=E)) + labs(x = expression("log(B"[0]*")"), y = "E")+
geom_point(size=4, shape=16,color = "black", alpha = 0.7) + theme_bw() + theme(panel.background = element_blank(), text = element_text(size = 35))
dev.off()
summ = read.csv("../data/summary_TS.csv")
summ = summ[-which(summ$Points_Before_Peak < 3),]
summ = summ[which(summ$Trait == "Specific Growth Rate"),]
summ = summ[-which(summ$AIC > 100),]
summ = summ[-which(summ$E_D < summ$E),]
summ = summ[-which(summ$T_pk > 370),]
summ = summ[-which(summ$E_D > 30),]
summ = summ[which(summ$ConKingdom == 'Bacteria'),]
#summ = summ[which(summ$B0>0),]
s_data = data.frame(summ$X, summ$Species, summ$B0, summ$E, summ$T_pk, summ$E_D, summ$R_Squared, summ$AIC, summ$BIC)
names(s_data) = c('ID', 'Species', 'B0', 'Ea', 'T_pk', 'E_D', 'r_sq', 'AIC', 'BIC')
s_data = s_data[-which(s_data$Ea > 3),]
cov(s_data$B0, s_data$Ea)
mean(s_data$B0); var(s_data$B0)
mean(s_data$Ea); var(s_data$Ea)
s_data = s_data[-which(s_data$Ea > 2),]
cov(s_data$B0, s_data$Ea)
mean(s_data$B0); var(s_data$B0)
mean(s_data$Ea); var(s_data$Ea)
data = read.csv("../data/aerobic_tpc_data.csv")
data = data[-which(data$temps_before_peak_resp<=3 | data$temps_before_peak_growth<=3),]
res_data = data.frame(data$E_resp, data$B0_resp, data$E_D_resp, data$Tpk_resp, data$Ppk_resp, data$r_sq_resp)
names(res_data) = c('Ea', 'B0', 'E_D', 'T_pk', 'P_pk','r_sq')
grow_data = data.frame(data$E_growth, data$B0_growth, data$E_D_growth, data$Tpk_growth, data$Ppk_growth, data$r_sq_growth)
names(grow_data) = c('Ea', 'B0', 'E_D', 'T_pk', 'P_pk','r_sq')
cov(log(res_data$B0), res_data$Ea)
mean(log(res_data$B0)); var(log(res_data$B0))
mean(res_data$Ea); var(res_data$Ea)
mean(res_data$B0)
var(res_data$Ea)
mean(log(res_data$B0)); var(log(res_data$B0))
mean(res_data$Ea); var(res_data$Ea)
var(log(res_data$B0))/mean(log(res_data$B0))
res_data$B0
cov(log(res_data$B0), res_data$Ea)/(sqrt(var(log(res_data$B0)))*sqrt(var(res_data$Ea)))
ggplot(s_data, aes(x=B0, y=E)) + labs(x = expression("log(B"[0]*")"), y = "E")+
geom_point(size=4, shape=16,color = "black", alpha = 0.7) + theme_bw() + theme(panel.background = element_blank(), text = element_text(size = 35))
summ = read.csv("../data/summary.csv")
s_data = summ[summ$source == "meta", ]
var(log(s_data$B0_ss))/mean(log(s_data$B0_ss))
var(s_data$E)/mean(s_data$E)
cov(log(s_data$B0_ss), s_data$E)
rho_r = cov(log(s_data$B0_ss), s_data$E)/(sqrt(var(log(s_data$B0_ss)))*sqrt(var(s_data$E)))
ggplot(s_data, aes(x=B0, y=E)) + labs(x = expression("log(B"[0]*")"), y = "E")+
geom_point(size=4, shape=16,color = "black", alpha = 0.7) + theme_bw() + theme(panel.background = element_blank(), text = element_text(size = 35))
ggplot(res_data, aes(x=B0, y=Ea)) + labs(x = expression("log(B"[0]*")"), y = "E")+
geom_point(size=4, shape=16,color = "black", alpha = 0.7) + theme_bw() + theme(panel.background = element_blank(), text = element_text(size = 35))
res_data
cov(log(s_data$B0_ss), s_data$E)
rho_r = cov(log(s_data$B0_ss), s_data$E)/(sqrt(var(log(s_data$B0_ss)))*sqrt(var(s_data$E)))
rho_r
ggplot(s_data, aes(x=B0, y=E)) + labs(x = expression("log(B"[0]*")"), y = "E")+
geom_point(size=4, shape=16,color = "black", alpha = 0.7) + theme_bw() + theme(panel.background = element_blank(), text = element_text(size = 35))
setwd(../code)
ls
setwd('~/Documents/div_cue_paper/data')
setwd('~/Documents/div_cue_paper/code')
setwd('~/Documents/div_cue_paper/data')
setwd('~/Documents/div_cue_paper/code')
###### Experimental growth and res data, but with two
data = read.csv("../data/aerobic_tpc_data.csv")
data = data[-which(data$temps_before_peak_resp<=3 | data$temps_before_peak_growth<=3),]
res_data = data.frame(data$E_resp, data$B0_resp, data$E_D_resp, data$Tpk_resp, data$Ppk_resp, data$r_sq_resp)
names(res_data) = c('Ea', 'B0', 'E_D', 'T_pk', 'P_pk','r_sq')
grow_data = data.frame(data$E_growth, data$B0_growth, data$E_D_growth, data$Tpk_growth, data$Ppk_growth, data$r_sq_growth)
names(grow_data) = c('Ea', 'B0', 'E_D', 'T_pk', 'P_pk','r_sq')
data
setwd('~/Documents/div_cue_paper/code')
graphics.off()
library(minpack.lm)
library(ggplot2)
library(reshape2)
library(grid)
data = read.csv("../data/aerobic_tpc_data.csv")
data = data[-which(data$temps_before_peak_resp<=3 | data$temps_before_peak_growth<=3),]
res_data = data.frame(data$E_resp, data$B0_resp, data$E_D_resp, data$Tpk_resp, data$Ppk_resp, data$r_sq_resp)
names(res_data) = c('Ea', 'B0', 'E_D', 'T_pk', 'P_pk','r_sq')
grow_data = data.frame(data$E_growth, data$B0_growth, data$E_D_growth, data$Tpk_growth, data$Ppk_growth, data$r_sq_growth)
names(grow_data) = c('Ea', 'B0', 'E_D', 'T_pk', 'P_pk','r_sq')
var_r = var(log(grow_data$B0))/mean(log(grow_data$B0))
var_r
var_r = var(log(grow_data$B0))/abs(mean(log(grow_data$B0)))
var_r
var_Br = var(log(grow_data$B0))/abs(mean(log(grow_data$B0)))
var_Er =
rho_r = cov(log(grow_data$B0), grow_data$Ea)
var_Er = var(grow_data$Ea)/abs(mean(grow_data$Ea))
var_Er
mean_Br = mean(log(grow_data$B0))
mean_Er = mean(grow_data$Ea)
mean_Br
mean_Er
grow_data$B0
mean_Br = mean(log(grow_data$B0))
mean_Er = mean(grow_data$Ea)
var_Br = var(log(grow_data$B0))/abs(mean_Br)
var_Er = var(grow_data$Ea)/abs(mean_Er)
cov(log(grow_data$B0), grow_data$Ea)
rho_r = cov(log(grow_data$B0), grow_data$Ea)/(sqrt(var_Br) * sqrt(var_Er))
rho_r
sqrt(var_Br)
sqrt(var_Er)
mean_Br = mean(log(grow_data$B0))
mean_Er = mean(grow_data$Ea)
var_Br = var(log(grow_data$B0))/abs(mean_Br)
var_Er = var(grow_data$Ea)/abs(mean_Er)
rho_r = cov(log(grow_data$B0), grow_data$Ea)/(sqrt(var_Br) * sqrt(var_Er))
rho_r
(sqrt(var_Br) * sqrt(var_Er))
cov(log(grow_data$B0), grow_data$Ea)
rho_r = cov(log(grow_data$B0), grow_data$Ea)/(sqrt(var(log(grow_data$B0))) * sqrt(var(grow_data$Ea)))
rho_r
mean_Bm = mean(log(res_data$B0))
mean_Em = mean(res_data$Ea)
var_Bm = var(log(res_data$B0))/abs(mean_Bm)
var_Em = var(res_data$Ea)/abs(mean_Em)
rho_m = cov(log(res_data$B0), res_data$Ea)/(sqrt(var(log(res_data$B0))) * sqrt(var(res_data$Ea)))
rho_m
###### Metadata of growth, Tr = 10 ########
###### smith2019community ######
###### reanalysed in clegg2022variation, changed Tr to 10 #######
summ = read.csv("../data/summary.csv")
s_data = summ[summ$source == "meta", ]
var(log(s_data$B0_ss))/mean(log(s_data$B0_ss))
svar_Br = var(log(s_data$B0_ss))/mean(log(s_data$B0_ss))
svar_Er = var(s_data$E)/mean(s_data$E)
srho_r = cov(log(s_data$B0_ss), s_data$E)/(sqrt(var(log(s_data$B0_ss)))*sqrt(var(s_data$E)))
srho_r
svar_Er
svar_Br
smean_Br = mean(log(s_data$B0_ss))
smean_Br
smean_Er = mean(s_data$E)
smean_Er
mean_Em
mean_Bm
srho_r = cov(log(s_data$B0_ss), s_data$E)/(sqrt(var(log(s_data$B0_ss)))*sqrt(var(s_data$E)))
srho_r
Schoolfield = function(Temp, B0, T_pk, Ea, E_D){
return(B0*exp(-Ea*(1/Temp-1/273.15)/k)/(1+(Ea/(E_D-Ea))*exp(E_D*(1/T_pk-1/Temp)/k)))
}
CUE = function(G, R){
return(G/(G+R))
}
Schoolfield = function(Temp, B0, T_pk, Ea, E_D){
return(B0*exp(-Ea*(1/Temp-1/283.15)/k)/(1+(Ea/(E_D-Ea))*exp(E_D*(1/T_pk-1/Temp)/k)))
}
CUE = function(G, R){
return(G/(G+R))
}
G = Schoolfield(Temp = 273.15:323.15, B0 = grow_data$B0[i], T_pk = grow_data$T_pk[i], Ea = grow_data$Ea[i], E_D = grow_data$E_D[i])
R = Schoolfield(Temp = 273.15:323.15, B0 = res_data$B0[i], T_pk = res_data$T_pk[i], Ea = res_data$Ea[i], E_D = res_data$E_D[i])
plot(1, type="n", xlab = "Temperature(celsius)", ylab = 'CUE', xlim=c(0, 50), ylim=c(0, 1))
for(i in 1:nrow(grow_data)){
lines(CUE(G = Schoolfield(Temp = 273.15:323.15, B0 = grow_data$B0[i], T_pk = grow_data$T_pk[i], Ea = grow_data$Ea[i], E_D = grow_data$E_D[i]), R = Schoolfield(Temp = 273.15:323.15, B0 = res_data$B0[i], T_pk = res_data$T_pk[i], Ea = res_data$Ea[i], E_D = res_data$E_D[i])), typ = 'l')
}
CUE_Values= data.frame()
for(i in 1:nrow(grow_data)){
CUE_Values = rbind(CUE_Values, CUE(G = Schoolfield(Temp = 273.15, B0 = grow_data$B0[i], T_pk = grow_data$T_pk[i], Ea = grow_data$Ea[i], E_D = grow_data$E_D[i]), R = Schoolfield(Temp = 273.15:323.15, B0 = res_data$B0[i], T_pk = res_data$T_pk[i], Ea = res_data$Ea[i], E_D = res_data$E_D[i])))
}
CUE(G = Schoolfield(Temp = 273.15:323.15, B0 = grow_data$B0[i], T_pk = grow_data$T_pk[i], Ea = grow_data$Ea[i], E_D = grow_data$E_D[i]), R = Schoolfield(Temp = 273.15:323.15, B0 = res_data$B0[i], T_pk = res_data$T_pk[i], Ea = res_data$Ea[i], E_D = res_data$E_D[i]))
CUE_0 = grow_data$B0/(grow_data$B0+res_data$B0)
CUE_0
mean(CUE_0)
CUE_0 = grow_data$B0/(grow_data$B0+res_data$B0)
hist(CUE_0)
mean(CUE_0)
mean_Br = mean(log(grow_data$B0))
mean_Br
mean(CUE_0) - sd(CUE_0)/sqrt(nrow(grow_data))
mean(CUE_0) + sd(CUE_0)/sqrt(nrow(grow_data))
mean_Br
mean_Bm
log(res_data$B0)
res_data$B0
mean(res_data$B0)
mean_Bm = mean(res_data$B0)
mean_Br = mean(grow_data$B0)
mean_Br
mean_Er
smean_Br = mean(s_data$B0_ss)
smean_Br
# Carbon use efficiency
CUE_0 = grow_data$B0/(grow_data$B0+res_data$B0)
mean(CUE_0)
